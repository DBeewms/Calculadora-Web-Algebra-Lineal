{% extends "algebra/base.html" %}
{% block title %}Método de bisección — KiwiSolve{% endblock %}
{% block content %}
<section class="section">
  <h2>{{ title }}</h2>

  <form method="post" class="panel" style="padding:16px;">
    {% csrf_token %}
    <div class="grid">
      <div class="control">
        <label>Función f(x) (usar funciones de math: sin, cos, exp, log, sqrt, etc.)</label>
        <input name="function" type="text" value="{{ function|default:'x**3 - x - 1' }}" placeholder="Ej: x**3 - x - 1" />
      </div>
      <div class="control">
        <label>a (extremo izquierdo)</label>
        <input name="a" type="text" value="{{ a_input|default:'1' }}" />
      </div>
      <div class="control">
        <label>b (extremo derecho)</label>
        <input name="b" type="text" value="{{ b_input|default:'2' }}" />
      </div>
      <div class="control">
        <label>Tolerancia ε</label>
        <input name="tol" type="text" value="{{ tol_input|default:'1e-6' }}" />
      </div>
      <div class="control">
        <label>Max iteraciones</label>
        <input name="maxit" type="text" value="{{ maxit_input|default:'100' }}" />
      </div>
    </div>
    <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
      <button type="submit" class="btn">Calcular</button>
      <button type="button" class="btn ghost" data-action="clear" aria-label="Limpiar formulario">Limpiar</button>
    </div>
  </form>

  {% if error %}
    <div class="panel" style="margin-top:12px; padding:12px; border:1px solid #f5c2c7; background:#fff0f0; color:#811;">{{ error }}</div>
  {% endif %}

  {% if message %}
    <div class="panel" style="margin-top:12px; padding:12px; border:1px solid #cde; background:#f0f8ff;">{{ message }}</div>
  {% endif %}

  {% if iteraciones %}
    <div class="panel" style="margin-top:12px; padding:12px; overflow:auto;">
      <h3>Tabla de iteraciones</h3>
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr>
            <th style="border:1px solid var(--border); padding:8px;">i</th>
            <th style="border:1px solid var(--border); padding:8px;">a</th>
            <th style="border:1px solid var(--border); padding:8px;">b</th>
            <th style="border:1px solid var(--border); padding:8px;">c = (a+b)/2</th>
            <th style="border:1px solid var(--border); padding:8px;">f(a)</th>
            <th style="border:1px solid var(--border); padding:8px;">f(b)</th>
            <th style="border:1px solid var(--border); padding:8px;">f(c)</th>
            <th style="border:1px solid var(--border); padding:8px;">Actualización</th>
          </tr>
        </thead>
        <tbody>
          {% for it in iteraciones %}
          <tr>
            <td style="border:1px solid var(--border); padding:6px; text-align:center;">{{ it.i }}</td>
            <td style="border:1px solid var(--border); padding:6px;">{{ it.a }}</td>
            <td style="border:1px solid var(--border); padding:6px;">{{ it.b }}</td>
            <td style="border:1px solid var(--border); padding:6px;">{{ it.c }}</td>
            <td style="border:1px solid var(--border); padding:6px;">{{ it.fa }}</td>
            <td style="border:1px solid var(--border); padding:6px;">{{ it.fb }}</td>
            <td style="border:1px solid var(--border); padding:6px;">{{ it.fc }}</td>
            <td style="border:1px solid var(--border); padding:6px; text-align:center;">{{ it.actualizacion }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <h4 style="margin-top:12px;">Resumen</h4>
      <p>El método {{ convergio|yesno:"converge,no converge" }} en {{ conteo_iter }} iteraciones.</p>
      <p>La raíz aproximada es: <strong>{{ raiz }}</strong></p>
      <p>Estimación del error (intervalo/2): <strong>{{ estimacion_error }}</strong></p>
      <p>f(raíz) = {{ f_en_raiz }}</p>
    </div>
  {% endif %}

</section>
{% endblock %}
